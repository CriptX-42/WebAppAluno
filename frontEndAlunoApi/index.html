<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Document</title>
    </head>
    <body>
        <h2 id="titulo">Cadastrar Aluno</h2>
        <div><label>Nome:</label><input type="text" id="nome"></div>
        <div><label>Sobrenome:</label><input type="text" id="sobrenome"></div>
        <div><label>Telefone:</label><input type="text" id="telefone"></div>
        <div><label>RA:</label><input type="text" id="ra"></div>
        <div><label>Descrição:</label><input type="text" id="descricao"></div>
        <div>
            <button id='btnSalvar' onclick="Cadastrar()">Cadastrar</button>
            <button id='btnCancelar' onclick="Cancelar()">Cancelar</button>
        </div>
        <table boder="1">
            <thead>
                <tr>
                    <td>Nome</td>
                    <td>Sobrenome</td>
                    <td>Telefone</td>
                    <td>RA</td>
                    <td>Descrição</td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
            </tbody>
        </table>
        <script type="text/javascript">
            var tbody = document.querySelector('table tbody');
            var aluno = {};
            function Cadastrar(){        
                aluno.nome = document.querySelector('#nome').value;
                aluno.sobrenome = document.querySelector('#sobrenome').value;
                aluno.telefone = document.querySelector('#telefone').value;
                aluno.ra = document.querySelector('#ra').value;
                aluno.descricao = document.querySelector('#descricao').value;
                
                console.log(aluno)
                if(aluno.id === undefined || aluno.id === 0){
                    salvarEstudantes(`POST`, 0, aluno);
                }else{
                    salvarEstudantes(`PUT`, aluno.id, aluno);
                }
                carregaEstudantes();
            }

            function Cancelar(){
                var btnSalvar = document.querySelector('#btnSalvar');
                var btnCancelar = document.querySelector('#btnCancelar');
                var lblTitulo = document.querySelector('#titulo');

                document.querySelector('#nome').value = "";
                document.querySelector('#sobrenome').value = "";
                document.querySelector('#telefone').value = "";
                document.querySelector('#ra').value = "";
                document.querySelector('#descricao').value = "";

                aluno = {};
                
                btnSalvar.textContent = 'Cadastrar';
                btnCancelar.textContent = 'Limpar';
                lblTitulo.textContent = 'Cadastrar Aluno';
            }

            function carregaEstudantes(){
                tbody.innerHTML = '';
                var xhr = new XMLHttpRequest();
                
                xhr.open(`GET`, `http://localhost:52702/api/Aluno/`, true);
                xhr.onload = function (){
                    var estudantes = JSON.parse(this.responseText);
                    for(var i in estudantes){
                        adicionaLinha(estudantes[i])
                    }
                }
                console.log("teste")
                xhr.send();
            }

            function salvarEstudantes(metodo, id, corpo){
                var xhr = new XMLHttpRequest();

                if(id === undefined || id === 0){
                    id = '';
                }
                xhr.open(metodo, `http://localhost:52702/api/Aluno/${id}`, false);
                
                
                xhr.setRequestHeader('content-type', 'application/json');
                xhr.send(JSON.stringify(corpo));
                
                
            }

            function excluirEstudante(id){
                var xhr = new XMLHttpRequest();

                if(id === undefined || id === 0){
                    id = '';
                }
                xhr.open(`Delete`, `http://localhost:52702/api/Aluno/${id}`, false);
                xhr.send();
            }

            function excluir(id){
                excluirEstudante(id);
                carregaEstudantes();
            }

            function editarEstudante(estudante){
                var btnSalvar = document.querySelector('#btnSalvar')
                var btnCancelar = document.querySelector('#btnCancelar')
                var lblTitulo = document.querySelector('#titulo');

                document.querySelector('#nome').value = estudante.nome;
                document.querySelector('#sobrenome').value = estudante.sobrenome;
                document.querySelector('#telefone').value = estudante.telefone;
                document.querySelector('#ra').value = estudante.ra;
                document.querySelector('#descricao').value = estudante.descricao;
        
                btnSalvar.textContent = 'Salvar';
                btnCancelar.textContent = 'Cancelar';
                lblTitulo.textContent = `Editar Aluno ${estudante.nome} ${estudante.sobrenome}`;
                
                aluno = estudante;
            }
            carregaEstudantes();
            
            function adicionaLinha(estudante){
                var trow = `<tr>
                                <td>${estudante.nome}</td>
                                <td>${estudante.sobrenome}</td>
                                <td>${estudante.telefone}</td>
                                <td>${estudante.ra}</td>
                                <td>${estudante.descricao}</td>
                                <td><button onclick='editarEstudante(${JSON.stringify(estudante)})'>Editar</button>
                                    <button onclick='excluir(${estudante.id})'>Deletar</button>
                                </td>
                            <tr>`;
                tbody.innerHTML += trow;                 
            }
        </script>
    </body>
</html>